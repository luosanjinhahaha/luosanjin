<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:fragment="fastDFS_images">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<style>
    html::-webkit-scrollbar{
        display: none;
    }
</style>
<body>
<div class="wrapper">
    <div class="content-wrapper">
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1 class="m-0 text-dark">宜家医坊文件管理中心</h1>
                    </div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="#">主页</a></li>
                            <li class="breadcrumb-item active">文件管理中心</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-2">
                        <div class="small-box bg-info" onclick="window.open('/admin/add_patients')" title="患者添加">
                            <a href="javascript:;" class="small-box-footer">图片管理中心</a>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="small-box bg-success">
                            <a href="#" class="small-box-footer">体检表管理中心</a>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="small-box bg-warning" onclick="window.open('/admin/useradmin')" title="修改管理员权限">
                            <a href="#" class="small-box-footer" style="color: white !important">病历管理中心</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 文件区 -->
        <section class="content">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body" id="imgSource">

                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>
<footer class="main-footer"> <strong>© 2018 YJYF
    Medical Center. All Rights Reserved.  宜家医坊总裁办公室所有</strong>
    <div class="float-right d-none d-sm-inline-block">
        <b>Version</b> 3.0.0-alpha
    </div>
</footer>
</body>
<script>
    var http = "http://localhost:9527/medical"
    window.onload = function(){
        $('#imgSource').css('height','1100px');
        $.ajax({
            url: "/medical/admin/showFastDfsImg",
            type:"GET",
            xhrFields: {
                withCredentials: true
            },
            success:function(res){
                console.log(res);
            // .css('height','160px').css('object-fit','cover')
                $.each(res.extend.fastDfsImg,function(index, item){
                    var imtItem = $('<div></div>').addClass('imgItem').css('margin-right','8px').css('margin-bottom','8px').css('width','200px')
                        .css('border','1px solid #ddd').css('border-radius','5px').css('padding','10px')
                        .append($('<img></img>').attr('src',item.imgPath).css('width','180px').css('height','160px').css('object-fit','cover')
                            .css('border','1px solid #ddd')).append($('<p></p>').text('参考路径：')
                            .append($('<div style="height:100px;"></div>').addClass('fastDFS_path').text(item.imgPath))
                            .append($('<button></button>').prop('id',item.imgId).css('position','relative').css('top','20px').css('left','120px')
                                .addClass('btn btn-danger btn-sm deleteImg_btn').css('width','60px').append($('<span>删除</span>')))).appendTo('#imgSource');
                });
                $('#imgSource').masonry({
                    itemSelector: '.imgItem',
                });
            }
        });

        $(document).on('click','.deleteImg_btn',function(){
            var oldPath = $(this).siblings('.fastDFS_path').text();
            var path = oldPath.substring(27,oldPath.length);
            console.log(path);
            swal({
                title: "确定从fastDFS上删除路径为" + path + "的文件吗？",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "确认",
                cancelButtonText: "取消",
                closeOnConfirm: false,
                closeOnCancel: false
            },function(isConfirm){
                if(isConfirm){
                    $.ajax({
                        // url:http + "/consumer/admin/fastDFS_delete",
                        url:"/medical/admin/fastDFS_delete",
                        type:"POST",
                        xhrFields: {
                            withCredentials: true
                        },
                        data:{oldPath:path},
                        success:function(res){
                            if(res.code = 200){
                                swal({
                                    title: "删除成功！",
                                    type: "success"
                                },function(){
                                    window.location.reload();
                                });
                            }else{
                                swal({
                                    title: "删除失败！",
                                    type: "error"
                                });
                            }
                        },
                        error:function(){
                            swal({
                                title:"系统发生未知错误！删除失败！",
                                type:"error"
                            });
                        }
                    });
                }else{
                    swal({
                        title: "您已取消删除！",
                        type: "success"
                    });
                }
            });
        });
    }
</script>
</html>