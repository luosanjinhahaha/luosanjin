<!DOCTYPE html>
<!--suppress ALL-->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>个性定制-您的专属理疗方案</title>
</head>
<style>
    html::-webkit-scrollbar
    {
        width: 5px;
        height: 10px;
        background-color: #F5F5F5;
    }

    /*定义滚动条轨道 内阴影+圆角*/
    ::-webkit-scrollbar-track
    {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
        border-radius: 5px;
        background-color: #F5F5F5;
    }

    /*定义滑块 内阴影+圆角*/
    ::-webkit-scrollbar-thumb
    {
        border-radius: 10px;
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
        background-color: #555;
    }

    .inner img {
        height: 118px;
        margin-left: 10px;
        object-fit: cover;
        float: right;
        position: relative;
    }
</style>
<link rel="icon" th:href="@{/images/homepage_images/core-img/favicon.ico}">
<link rel="stylesheet" th:href="@{/css/homepage_css/style.css}">
<!--<link rel="stylesheet" th:href="@{/css/homepage_css/bootstrap.min.css}">-->
<link rel="stylesheet" th:href="@{/css/main_css/foundation-datepicker.css}">
<link rel="stylesheet" th:href="@{/css/sweetalert_css/sweet-alert.css}">
<link rel="stylesheet" th:href="@{/css/data_table_css/plugin/datatables/datatables.css}">
<link rel="stylesheet" th:href="@{/css/main_css/customization.css}">
<link rel="stylesheet" th:href="@{/css/homepage_css/number-pb.css}">
<body>
<div th:replace="~{common/loading::loading}"></div>
<div th:replace="~{common/header::header(activeUri = '/user/doctorlist')}"></div>
<section class="breadcumb-area bg-img gradient-background-overlay"
         style="background-image: url('/medical/images/homepage_images/bg-img/breadcumb2.jpg');">
    <div class="container h-100">
        <div class="row h-100 align-items-center">
            <div class="col-12">
                <div class="breadcumb-content">
                    <h3 class="breadcumb-title">开始定制您的理疗方案</h3>
                    <br>
                    <p>根据您的情况，给出一对一的理疗方案并智能推荐医师进行专业详细的问诊，给您最好的服务体验。</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!--开始个性化定制理疗方案-->
<form id="customForm">
<table class="table table-bordered table-striped" style="margin-top: 20px">
    <thead>
        <tr>
            <th th:colspan="8" style="font-size: 20px;">基本信息
                &nbsp;&nbsp;&nbsp;&nbsp;
                <span style="font-size: 15px;color: #006cff;">为能得到准确的方案请务必如实填写以下信息</span>
                <button type="button" id="blank-page" class="btn btn-sm btn-primary blank-page" style="float:right;">空白页</button>
            </th>
        </tr>
    </thead>
    <tbody class="tbody1">
    <tr style="line-height: 30px;">
        <td>姓名:</td>
        <td th:colspan="3"><input type="text" name="customName" th:value="${customizationInfo.realname}"></td>
        <td>年龄:</td>
        <td th:colspan="3"><input type="text" name="customAge" th:value="${customizationInfo.age}"></td>
    </tr>
    <tr style="line-height: 30px;">
        <td>性别:</td>
        <td th:colspan="3">
            <input type="text" class="jiade" style="display: none;" th:value="${customizationInfo.sex}"/>
            <input type="radio" name="customSex" value="男">&nbsp;男&emsp;&emsp;
            <input type="radio" name="customSex" value="女">&nbsp;女
        </td>
        <td>名族:</td>
        <td>
            <select name="customNation" id="" style="border: 1px solid #e7eaed;">
                <option value="汉">汉</option>
                <option value="满族">满族</option>
                <option value="苗族">苗族</option>
                <option value="维吾尔族">维吾尔族</option>
                <option value="">...</option>
            </select>
        </td>
        <td>血型:</td>
        <td>
            <select name="customBlood" id="" style="border: 1px solid #e7eaed;">
                <option value="A型">A型</option>
                <option value="B型">B型</option>
                <option value="AB型">AB型</option>
                <option value="O型">O型</option>
                <option value="Rh阴性血型">Rh阴性血型</option>
                <option value="不清楚">不清楚</option>
            </select>
        </td>
    </tr>
    <tr style="line-height: 30px;">
        <td>出生日期:</td>
        <td><input id="customDate" name="customBirth" type="text" style="border: 1px solid #e7eaed;" value=""></td>
        <td>职业:</td>
        <td>
            <select name="customWork" id="" style="width: 100px;">
                <option value="小学">小学</option>
                <option value="初中">初中</option>
                <option value="高中">高中</option>
                <option value="大学">大学</option>
                <option value="研究生">研究生</option>
            </select>
        </td>
        <td>婚姻状况:</td>
        <td th:colspan="3" style="line-height: 42px;">&emsp;&emsp;&emsp;
            <input type="radio" name="customMarriage" value="未婚" checked>&nbsp;未婚&emsp;&emsp;
            <input type="radio" name="customMarriage" value="已婚">&nbsp;已婚&emsp;&emsp;
            <input type="radio" name="customMarriage" value="离异">&nbsp;离异&emsp;&emsp;
            <input type="radio" name="customMarriage" value="丧偶">&nbsp;丧偶&emsp;&emsp;
        </td>
    </tr>
    <tr style="line-height: 30px;">
        <td>联系电话:</td>
        <td>
            <input type="text" name="customPhone" style="border: 1px solid #e7eaed;" th:value="${customizationInfo.phone}">
        </td>
        <td>邮箱:</td>
        <td>
            <input type="text" name="customEmail" style="border: 1px solid #e7eaed;" th:value="${customizationInfo.email}">
        </td>
        <td>出生地:</td>
        <td th:colspan="3" class="info" data-toggle="distpicker">
            <span style="display: inline-block;margin-right: 20px;">
                <select id="customProvince"  name="customProvince" style="border: 1px solid #e7eaed;height: 30px;"></select>  
            </span>
            <span style="display: inline-block;margin-right: 10px;">
                <select id="customCity" name="customCity"style="border: 1px solid #e7eaed;height: 30px;"></select>  
            </span>
            <span style="display: inline-block;">
                <select id="customCounty" name="customCounty"style="border: 1px solid #e7eaed;height: 30px;"></select>
            </span>
        </td>
    </tr>
    <tr style="line-height: 30px;">
        <td>医保卡号:</td>
        <td th:colspan="3">
            <input type="text" placeholder="&nbsp;没有可不填写" name="customHealthCard" style="width: 300px;border: 1px solid #e7eaed;">
        </td>
        <td>身份证件号:</td>
        <td th:colspan="3">
            <input type="text" name="customIdentityCard" style="width: 300px;border: 1px solid #e7eaed;">
        </td>
    </tr>
    <tr style="line-height: 30px;">
        <td>居住地址:</td>
        <td th:colspan="7">
            <span style="display: inline-block;">
                <span>现住地址:&nbsp;</span><input type="text" name="customLivePlace" style="width: 400px;border: 1px solid #e7eaed;">&emsp;&emsp;
            </span>
            <span style="display: inline-block;">
                <span>邮政编码:&nbsp;</span><input placeholder="&nbsp;可不填写" type="text" name="customLivePostcode" style="width: 200px;border: 1px solid #e7eaed;">&emsp;&emsp;
            </span>
        </td>
    </tr>
    <tr style="line-height: 30px;">
        <td>家属电话1:</td>
        <td th:colspan="3">
            <input type="text" name="customMan1" style="width: 300px;border: 1px solid #e7eaed;">
        </td>
        <td>家属电话2:</td>
        <td th:colspan="3">
            <input type="text" name="customMan2" style="width: 300px;border: 1px solid #e7eaed;">
        </td>
    </tr>
    </tbody>
    <thead>
    <tr>
        <th th:colspan="8" style="font-size: 20px;">病况信息</th>
    </tr>
    </thead>
    <tbody class="tbody2">
        <tr style="line-height: 30px;">
            <td>病症类别:</td>
            <td th:colspan="7">
                <span class="patientType">类型:</span>
                <span style="display: inline-block;margin-right: 30px;">
                    <select name="customDepartment" id="">
                        <option value="内科">内科</option>
                        <option value="外科">外科</option>
                    </select>
                </span>
                <span class="patientType">类型:</span>
                <span style="display: inline-block;margin-right: 30px;">
                    <select name="customIllType" id="">
                        <option value="呼吸系统疾病">颈椎类疾病</option>
                        <option value="急性脑血管病">心脑血管病</option>
                    </select>
                </span>
                <span class="patientType">类型:</span>
                <span style="display: inline-block;margin-right: 30px;">
                    <select name="customDetails" id="customDetails" selected>
                        <option value="颈椎病">颈椎病</option>
                        <option value="高血压病">高血压病</option>
                        <option value="痛风">痛风</option>
                        <option value="肩周炎">肩周炎</option>
                    </select>
                </span>
            </td>
        </tr>
    <tr style="line-height: 30px;">
        <td>病症详情:</td>
        <td th:colspan="7">
            <input type="text" name="customParticulars" style="width: 1100px;" placeholder="也可以在在这里写入详情">
        </td>
    </tr>
        <tr style="line-height: 30px;">
            <td>持续时间:</td>
            <td>
                <input type="text" name="customDuration" style="width: 100px;">&emsp;(单位天)
            </td>
            <td>生病季节:</td>
            <td>
                <select name="customSeason" id="" style="width: 100px;">
                    <option value="春季">春季</option>
                    <option value="春季">夏季</option>
                    <option value="春季">秋季</option>
                    <option value="春季">冬季</option>
                </select>
            </td>
            <td th:colspan="4" class="btns">
                <button type="button" class="btn btn-sm btn-primary" id="create">保存并生成方案</button>
                <button class="btn btn-sm btn-danger" style="margin-left: 30px;">重置信息</button>
            </td>
        </tr>
    </tbody>
</table>
</form>
<div th:replace="~{common/footer::footer}"></div>
<!--模态窗口-->
<div id="modal" class="modal" style="background: rgba(0,0,0,.4);">
    <div class="modal-dialog animated">
        <div class="modal-content" style="width: 1095px; left: -175px;">
            <form class="form-horizontal" method="get">
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row row1">
                            <table class="tablePuwai table col-sm-3"></table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" type="button" onclick="modal.close();">取消</button>
                    <button class="btn btn-primary" type="submit" onclick="modal.close();">保存</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script th:src="@{/js/homepage_js/jquery-2.2.4.min.js}"></script>
<script th:src="@{/js/area_js/area.js}"></script>
<script>_init_area();</script>
<script th:src="@{/js/homepage_js/popper.min.js}"></script>
<script th:src="@{/js/homepage_js/bootstrap.min.js}"></script>
<script th:src="@{/bootstrap/js/bootstrap.js}"></script>
<script th:src="@{/js/homepage_js/plugins.js}"></script>
<script th:src="@{/js/main_js/foundation-datepicker.js}"></script>
<script th:src="@{/js/main_js/foundation-datepicker.zh-CN.js}"></script>
<script th:src="@{/js/main_js/datatables.min.js}"></script>
<script th:src="@{/js/sweetalert_js/sweet-alert.min.js}"></script>
<script th:src="@{/js/homepage_js/number-pb.js}"></script>
<script th:src="@{/js/homepage_js/jquery.velocity.min.js}"></script>
<script th:src="@{/js/main_js/rmodal.js}"></script>
<script th:src="@{/webjars/sockjs-client/sockjs.min.js}"></script>
<script th:src="@{/webjars/stomp-websocket/stomp.min.js}"></script>
</body>
<script>
    // 日期选择
    $('#customDate').fdatepicker({
        format: 'yyyy-mm-dd',
    });
    $("input[name=customSex]").val([$(".jiade").val()]);

    $(function () {
        connect();

    });

    /*WebSocket 配置*/
    var stompClient = null;
    function setConnected(connected) {
        $("#connect").prop("disabled", connected);

        //  /push/customDetails
        stompClient.subscribe('/push/customDetails', function (result) {
            showCustomDetails(JSON.parse(result.body));
            // console.log("result: " + result);
        });
    }

    function showCustomDetails(result) {
        $.each(result, function (index, item) {
            var ahref = $('<a></a>').attr('href',item.docPath).append(item.docName);
            var tr = $('<tr></tr>').append($('<td></td>').append(ahref));
            tr.appendTo('.tablePuwai');
        });
    }

    /*连接*/
    function connect() {
        /*连接上端点(基站)*/
        var socket = new SockJS('/medical/endpoint-websocket');
        /*用stom进行包装，规范协议*/
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            setConnected(true);
        });
    }

    //生成理疗方案
    $("#create").click(function () {
        swal({
            title : "您确认信息都填写正确并确认提交了吗？",
            type : "warning",
            showCancelButton : true,
            confirmButtonColor : "#DD6B55",
            confirmButtonText : "确认",
            cancelButtonText : "取消",
            closeOnConfirm : false,
            closeOnCancel : false
        },function (isConfirm) {
            if(isConfirm){
                $.ajax({
                    url:"/medical/user/customization",
                    type:"POST",
                    async:false,
                    data:$("#customForm").serialize(),
                    success:function (res) {
                        if(res.code = 200){
                            swal({
                                title:"生成方案成功！",
                                text:"请返回下载或预约",
                                type:"success"
                            },function () {
                                $('.scheme').css('display','inline-block');
                                modal.open();
                                window.modal = modal;
                                stompClient.send("/app/push/treatment", {}, JSON.stringify({'customDetails': $("#customDetails").find("option:selected").text()}));
                                buildpuWaiDor(res);
                            });
                            console.log(res.extend);
                        }
                    }
                });
            }else{
                swal({
                    title : "您已取消提交！",
                    type : "success"
                });
            }
        });

        function buildpuWaiDor(res) {
            // $('.row1').empty();
            $.each(res.extend.puWaiDor, function (index, item) {
                var div = $('<div></div>').addClass('inner').append($('<span></span>').append($('<img/>').attr('src', item.doctorPhotoSrc)))
                    .append($('<div></div>').append(item.doctorName).css('position','relative').css('top','10px').css('left','90px'))
                    .append($('<a></a>').attr('href','deptWithDoct/' + item.doctorId).append('预约').css('position','relative').css('width','100px').css('top','20px').css('left','66px').addClass('puWaiDor btn btn-primary btn-sm profile-btn'));
                div.appendTo('.row1');
            });
        }

        $(document).on('clock', '.puWaiDor', function () {

        });


        var modal = new RModal(document.getElementById('modal'));
        document.addEventListener('keydown', function (ev) {
            modal.keydown(ev);
        }, true);

        document.getElementById('create').addEventListener("click", function (ev) {
            ev.preventDefault();
            modal.open();
        }, false);
    });

    $(".blank-page").click(function () {
        $('#customForm input').each(function () {
           $(this).val('');
        });
    })
</script>
</html>